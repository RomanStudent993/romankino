# Инструкция по развёртыванию на Render.com

## Шаг 1: Подготовка репозитория

1. Убедитесь, что все файлы добавлены в Git:
   ```bash
   git add .
   git commit -m "Подготовка к развёртыванию на Render"
   ```

2. Загрузите код на GitHub:
   ```bash
   git push origin main
   ```

## Шаг 2: Создание веб-сервиса на Render

1. Зайдите на [render.com](https://render.com) и войдите в аккаунт
2. Нажмите "New +" → "Web Service"
3. Подключите ваш GitHub репозиторий
4. Заполните форму:
   - **Name**: `kinopoisk-project` (или любое другое имя)
   - **Environment**: `Python 3`
   - **Region**: выберите ближайший регион
   - **Branch**: `main` (или ваша основная ветка)
   - **Root Directory**: оставьте пустым (если проект в корне репозитория)
   - **Build Command**: `./build.sh`
   - **Start Command**: `gunicorn kinopoisk_project.wsgi:application`
   - **Plan**: выберите план (Free или платный)

## Шаг 3: Создание PostgreSQL базы данных

1. Нажмите "New +" → "PostgreSQL"
2. Заполните форму:
   - **Name**: `kinopoisk-db`
   - **Database**: `kinopoisk`
   - **User**: `kinopoisk_user`
   - **Region**: тот же, что и для веб-сервиса
   - **Plan**: выберите план
3. После создания базы, Render автоматически создаст переменную `DATABASE_URL`
4. В настройках веб-сервиса подключите эту базу данных

## Шаг 4: Настройка переменных окружения

В настройках веб-сервиса перейдите в раздел "Environment" и добавьте:

1. **SECRET_KEY**:
   - Сгенерируйте новый ключ локально:
     ```bash
     python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
     ```
   - Скопируйте результат и вставьте в значение переменной

2. **DEBUG**: `False`

3. **ALLOWED_HOSTS**: 
   - После создания сервиса Render покажет вам URL (например: `kinopoisk-project.onrender.com`)
   - Добавьте этот URL в переменную: `kinopoisk-project.onrender.com`
   - Если у вас есть собственный домен, добавьте его тоже через запятую

4. **PYTHON_VERSION** (опционально): `3.11.0`

## Шаг 5: Развёртывание

1. Нажмите "Create Web Service"
2. Render начнёт процесс развёртывания
3. Дождитесь завершения (обычно 5-10 минут)
4. Проверьте логи, если что-то пошло не так

## Шаг 6: Создание суперпользователя

После успешного развёртывания:

1. Зайдите в ваш веб-сервис на Render
2. Откройте раздел "Shell"
3. Выполните команду:
   ```bash
   python manage.py createsuperuser
   ```
4. Введите данные для суперпользователя

## Шаг 7: Проверка работы

1. Откройте ваш сайт по адресу, который предоставил Render
2. Проверьте главную страницу
3. Зайдите в админ-панель: `https://your-app.onrender.com/admin/`
4. Войдите с данными суперпользователя

## Решение проблем

### Ошибка "DisallowedHost"
- Убедитесь, что в `ALLOWED_HOSTS` указан правильный домен от Render
- Проверьте, что переменная окружения `ALLOWED_HOSTS` установлена

### Ошибка подключения к базе данных
- Убедитесь, что PostgreSQL база создана и подключена к веб-сервису
- Проверьте, что переменная `DATABASE_URL` автоматически добавлена Render

### Статические файлы не загружаются
- Убедитесь, что команда `python manage.py collectstatic --no-input` выполняется в `build.sh`
- Проверьте, что WhiteNoise правильно настроен в `settings.py`

### Медиа файлы не отображаются
- На Render медиа файлы хранятся локально и могут быть потеряны при перезапуске
- Для production рекомендуется использовать облачное хранилище (AWS S3, Cloudinary)

## Дополнительные настройки

### Использование собственного домена
1. В настройках веб-сервиса перейдите в "Custom Domains"
2. Добавьте ваш домен
3. Обновите `ALLOWED_HOSTS` в переменных окружения

### Настройка автоматического развёртывания
- По умолчанию Render автоматически развёртывает при каждом push в основную ветку
- Это можно изменить в настройках сервиса

